@page "/"
@using System.Net.Http.Json
@inject HttpClient Http
@inject ISnackbar Snackbar

<PageTitle>Dashboard - MedEdge</PageTitle>

<MudContainer MaxWidth="MaxWidth.Lg">
    <MudText Typo="Typo.h3" Class="mb-6">Welcome to MedEdge Gateway</MudText>

    <MudGrid>
        <MudItem xs="12" sm="6" md="3">
            <MudCard Elevation="2">
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.body2">Active Devices</MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardContent>
                    <MudText Typo="Typo.h4">@activeDeviceCount</MudText>
                    <MudText Typo="Typo.caption">out of 3 online</MudText>
                </MudCardContent>
            </MudCard>
        </MudItem>

        <MudItem xs="12" sm="6" md="3">
            <MudCard Elevation="2">
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.body2">Total Observations</MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardContent>
                    <MudText Typo="Typo.h4">@totalObservations</MudText>
                    <MudText Typo="Typo.caption">recorded today</MudText>
                </MudCardContent>
            </MudCard>
        </MudItem>

        <MudItem xs="12" sm="6" md="3">
            <MudCard Elevation="2">
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.body2">Active Alerts</MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardContent>
                    <MudText Typo="Typo.h4" Color="Color.Error">@activeAlerts</MudText>
                    <MudText Typo="Typo.caption">requiring attention</MudText>
                </MudCardContent>
            </MudCard>
        </MudItem>

        <MudItem xs="12" sm="6" md="3">
            <MudCard Elevation="2">
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.body2">System Health</MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardContent>
                    <MudText Typo="Typo.h4" Color="Color.Success">
                        <MudIcon Icon="@Icons.Material.Filled.CheckCircle" />
                    </MudText>
                    <MudText Typo="Typo.caption">all services operational</MudText>
                </MudCardContent>
            </MudCard>
        </MudItem>
    </MudGrid>

    <MudGrid Class="mt-6">
        <MudItem xs="12" md="6">
            <MudCard Elevation="2">
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h6">Quick Actions</MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardContent>
                    <MudStack Spacing="2">
                        <MudButton Variant="Variant.Filled" Color="Color.Primary" FullWidth="true" OnClick="@(() => Navigation.NavigateTo("fleet-view"))">
                            <MudIcon Icon="@Icons.Material.Filled.LocalHospital" Class="mr-2" />
                            View Fleet Status
                        </MudButton>
                        <MudButton Variant="Variant.Filled" Color="Color.Primary" FullWidth="true" OnClick="@(() => Navigation.NavigateTo("vitals-monitor"))">
                            <MudIcon Icon="@Icons.Material.Filled.TrendingUp" Class="mr-2" />
                            Monitor Live Vitals
                        </MudButton>
                        <MudButton Variant="Variant.Filled" Color="Color.Primary" FullWidth="true" OnClick="@(() => Navigation.NavigateTo("fhir-inspector"))">
                            <MudIcon Icon="@Icons.Material.Filled.SearchBox" Class="mr-2" />
                            FHIR Inspector
                        </MudButton>
                    </MudStack>
                </MudCardContent>
            </MudCard>
        </MudItem>

        <MudItem xs="12" md="6">
            <MudCard Elevation="2">
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h6">System Information</MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardContent>
                    <MudStack Spacing="2">
                        <MudText Typo="Typo.body2">
                            <strong>Platform:</strong> MedEdge Gateway - NEXADIA Evolution
                        </MudText>
                        <MudText Typo="Typo.body2">
                            <strong>Version:</strong> 1.0.0-beta
                        </MudText>
                        <MudText Typo="Typo.body2">
                            <strong>Status:</strong> <MudChip Size="Size.Small" Color="Color.Success">Operational</MudChip>
                        </MudText>
                        <MudText Typo="Typo.body2">
                            <strong>FHIR:</strong> R4 (HL7 FHIR Release 4)
                        </MudText>
                        <MudText Typo="Typo.body2">
                            <strong>Last Updated:</strong> @lastUpdateTime.ToString("g")
                        </MudText>
                    </MudStack>
                </MudCardContent>
            </MudCard>
        </MudItem>
    </MudGrid>

    <MudGrid Class="mt-6">
        <MudItem xs="12">
            <MudCard Elevation="2">
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h6">Getting Started</MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardContent>
                    <MudTimeline TimelinePosition="TimelinePosition.Start" TimelineOrientation="TimelineOrientation.Vertical">
                        <MudTimelineItem Dense="true">
                            <MudText Typo="Typo.body2">
                                <strong>View Fleet Status</strong> - See all connected dialysis devices and their current state
                            </MudText>
                        </MudTimelineItem>
                        <MudTimelineItem Dense="true">
                            <MudText Typo="Typo.body2">
                                <strong>Monitor Live Vitals</strong> - Real-time display of blood flow, pressure, and temperature readings
                            </MudText>
                        </MudTimelineItem>
                        <MudTimelineItem Dense="true">
                            <MudText Typo="Typo.body2">
                                <strong>Inspect FHIR Resources</strong> - Query and export clinical data in FHIR R4 format
                            </MudText>
                        </MudTimelineItem>
                        <MudTimelineItem Dense="true">
                            <MudText Typo="Typo.body2">
                                <strong>Respond to Alerts</strong> - Receive AI-powered clinical alerts with recommendations
                            </MudText>
                        </MudTimelineItem>
                    </MudTimeline>
                </MudCardContent>
            </MudCard>
        </MudItem>
    </MudGrid>
</MudContainer>

@code {
    private int activeDeviceCount = 3;
    private int totalObservations = 1250;
    private int activeAlerts = 0;
    private DateTime lastUpdateTime = DateTime.UtcNow;

    @inject NavigationManager Navigation;

    protected override async Task OnInitializedAsync()
    {
        // Load dashboard statistics
        await LoadDashboardStats();
    }

    private async Task LoadDashboardStats()
    {
        try
        {
            // These would be real API calls in production
            await Task.Delay(500);
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading stats: {ex.Message}");
        }
    }
}
